# 语义模型与技术元模型关系可视化

## 📊 概述

`ontology_viz.html` 提供了一个交互式的图形可视化界面，展示 CIM 语义模型与 Iceberg 技术元模型之间的关系。

## 🎨 可视化元素

### 节点类型

1. **语义实体 (Entity)** - 蓝色圆形
   - 代表 CIM 语义模型中的实体类型
   - 例如：Substation、VoltageLevel、Breaker

2. **技术表 (Table)** - 绿色圆形
   - 代表 Iceberg 技术元模型中的表
   - 例如：ontology.grid.substation

3. **语义属性 (Attribute)** - 橙色小圆形
   - 代表实体的属性
   - 例如：mRID、name、region

4. **技术列 (Column)** - 红色小圆形
   - 代表表的列
   - 例如：entity_id、name、region

### 连线类型

1. **映射关系 (Mapping)** - 紫色虚线
   - 连接语义实体和技术表
   - 表示"实体映射到表"的关系
   - 标签：`maps to`

2. **语义关系 (Relationship)** - 蓝色实线
   - 连接两个语义实体
   - 表示实体之间的业务关系
   - 标签：关系类型（如 `contains`、`partOf`）

3. **属性关系 (Attribute)** - 灰色实线
   - 连接属性和实体
   - 表示"实体拥有属性"

4. **列关系 (Column)** - 灰色实线
   - 连接列和表
   - 表示"表拥有列"

## 🎯 视图模式

### 1. 完整视图 (Full View)
- 显示所有节点和关系
- 包括语义模型、技术元模型和映射关系

### 2. 仅语义模型 (Semantic Only)
- 只显示语义实体、属性和它们之间的关系
- 隐藏技术元模型部分

### 3. 仅技术元模型 (Technical Only)
- 只显示技术表、列和它们之间的关系
- 隐藏语义模型部分

### 4. 仅映射关系 (Mapping Only)
- 只显示语义实体到技术表的映射关系
- 突出显示映射连接

## 🖱️ 交互功能

### 节点操作

1. **拖拽节点**
   - 点击并拖拽节点可以重新布局
   - 释放后节点会保持新位置

2. **悬停提示**
   - 鼠标悬停在节点上显示详细信息
   - 包括节点类型、属性数量、关系数量等

### 图形布局

- **力导向图**: 使用 D3.js 的力导向布局算法
- **自动布局**: 节点会根据关系自动排列
- **碰撞检测**: 防止节点重叠

## 📐 图形结构

### 左侧区域：语义模型
- 语义实体节点
- 属性节点（围绕实体）
- 实体之间的关系连线

### 右侧区域：技术元模型
- 技术表节点
- 列节点（围绕表）
- 列与表的关系连线

### 中间区域：映射关系
- 紫色虚线连接语义实体和技术表
- 表示自动映射关系

## 🔍 使用示例

### 查看 Substation 的映射关系

1. 在完整视图中找到蓝色的 `Substation` 节点
2. 找到从 `Substation` 出发的紫色虚线
3. 跟随虚线找到绿色的 `substation` 表节点
4. 查看表节点周围的红色列节点

### 理解实体关系

1. 切换到"仅语义模型"视图
2. 查看实体之间的蓝色连线
3. 悬停在连线上查看关系类型
4. 例如：`Substation` → `contains` → `VoltageLevel`

### 分析表结构

1. 切换到"仅技术元模型"视图
2. 查看表节点周围的列节点
3. 理解表的列结构
4. 查看列的数据类型（悬停提示）

## 🎨 图例说明

页面底部提供完整的图例，包括：
- 节点颜色和类型
- 连线样式和含义
- 快速参考

## 🔧 技术实现

### 数据加载

1. 从 API 加载语义模型数据
   - `GET /api/ontology/entities`
   - 获取所有实体及其属性、关系

2. 从 API 加载映射数据
   - `GET /api/tables/mappings`
   - 获取实体到表的映射关系

3. 异步加载表结构
   - `GET /api/mapping/entity/{entity_name}`
   - 获取每个表的列信息

### 图形渲染

- **D3.js**: 用于图形渲染和力导向布局
- **SVG**: 矢量图形，支持缩放和交互
- **力导向算法**: 自动计算节点位置

## 📝 注意事项

1. **性能优化**
   - 只显示关键属性（前3个）和关键列（前4个）
   - 避免图形过于复杂

2. **数据加载**
   - 列信息是异步加载的
   - 如果网络较慢，可能需要等待

3. **浏览器兼容**
   - 需要现代浏览器支持 SVG 和 ES6
   - 推荐使用 Chrome、Firefox、Edge

## 🚀 访问方式

打开浏览器访问：
```
http://localhost:8000/ontology_viz.html
```

或从其他页面导航：
- 时间旅行页面 → 点击"关系可视化"
- 语义模型页面 → 点击"关系可视化"

## 🎯 应用场景

1. **理解映射关系**
   - 快速了解哪些实体映射到哪些表
   - 查看映射的完整性

2. **分析模型结构**
   - 理解语义模型的层次关系
   - 理解技术元模型的组织结构

3. **验证映射正确性**
   - 检查映射关系是否符合预期
   - 发现缺失的映射

4. **文档和演示**
   - 用于技术文档
   - 用于向团队展示架构

## 🔮 未来改进

1. **搜索和过滤**
   - 按实体名称搜索
   - 按表名称过滤

2. **导出功能**
   - 导出为 PNG/SVG 图片
   - 导出为 PDF

3. **更多视图**
   - 树形视图
   - 层次视图
   - 时间线视图

4. **交互增强**
   - 点击节点高亮相关节点
   - 双击节点查看详情
   - 右键菜单操作

